name: Deploy to Production Server

on:
  # –ó–∞–ø—É—Å–∫–∞—Ç—å –≤–æ—Ä–∫—Ñ–ª–æ—É –ø—Ä–∏ push –≤ –≤–µ—Ç–∫—É main
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest # –ù–∞ —á–µ–º –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å–∞–º –≤–æ—Ä–∫—Ñ–ª–æ—É

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Deploy to Server via SSH
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–π action –¥–ª—è SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}       # IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
          username: ${{ secrets.SSH_USER }}   # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
          key: ${{ secrets.SSH_PRIVATE_KEY }} # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH-–∫–ª—é—á –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
          port: 22                            # –ü–æ—Ä—Ç SSH (–æ–±—ã—á–Ω–æ 22)
          script: |
            # –ö–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ
            cd /home/Hori
            git pull
            python3 Main.py
            echo "‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!"

            # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω–æ–µ)
            # composer install --no-dev --optimize-autoloader
            # npm install && npm run build

            # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ (–ø—Ä–∏–º–µ—Ä)
            # sudo systemctl restart nginx
            # sudo systemctl restart php8.2-fpm
            # pm2 restart my-app
            echo "üöÄ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
